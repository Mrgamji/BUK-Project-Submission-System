<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="page-title mb-1">
              <i class="bi bi-people-fill me-2"></i>My Students
            </h1>
            <p class="page-subtitle mb-0">Manage and monitor all students assigned to you</p>
          </div>
          <div class="text-end">
            <span class="badge bg-primary fs-6">
              <i class="bi bi-person-check me-1"></i>
              <%= students ? students.length : 0 %> Students
            </span>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Alert Messages -->
    <% if (success) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i><%= success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>
    
    <% if (error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i><%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>
  
    <!-- Debug Info -->
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      <strong>Data Check:</strong> 
      Students: <%= students ? students.length : 'undefined' %>,
      Stats: <%= stats ? 'loaded' : 'undefined' %>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  
    <!-- Students List - Simplified Version -->
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-3">
        <h5 class="mb-0 fw-semibold">
          <i class="bi bi-list-ul me-2 text-primary"></i>Assigned Students
        </h5>
      </div>
      <div class="card-body">
        <% if (students && students.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Student Name</th>
                  <th>Email</th>
                  <th>Registration</th>
                  <th>Level</th>
                  <th>Department</th>
                  <th>Reports</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% students.forEach(student => { %>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                          <i class="bi bi-person-circle text-primary fs-5 me-2"></i>
                        </div>
                        <div class="flex-grow-1">
                          <strong><%= student.full_name %></strong>
                        </div>
                      </div>
                    </td>
                    <td><%= student.email %></td>
                    <td><%= student.registration_number || 'N/A' %></td>
                    <td>
                      <span class="badge bg-info"><%= student.level %> Level</span>
                    </td>
                    <td><%= student.department || 'N/A' %></td>
                    <td>
                      <div class="text-center">
                        <span class="fw-bold"><%= student.reportsCount || 0 %></span>
                        <div class="small text-muted">
                          <% if (student.pendingCount > 0) { %>
                            <span class="text-warning"><%= student.pendingCount %> pending</span>
                          <% } %>
                          <% if (student.approvedCount > 0) { %>
                            <span class="text-success"><%= student.approvedCount %> approved</span>
                          <% } %>
                        </div>
                      </div>
                    </td>
                    <td>
                      <% if (student.reportsCount === 0) { %>
                        <span class="badge bg-secondary">No Reports</span>
                      <% } else if (student.pendingCount > 0) { %>
                        <span class="badge bg-warning">Needs Review</span>
                      <% } else { %>
                        <span class="badge bg-success">All Reviewed</span>
                      <% } %>
                    </td>
                    <td>
                      <a href="/supervisor/student/<%= student.id %>" class="btn btn-sm btn-primary">
                        <i class="bi bi-eye me-1"></i>View
                      </a>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="text-center py-5">
            <i class="bi bi-people display-1 text-muted opacity-25 mb-3"></i>
            <h5 class="text-muted">No Students Assigned</h5>
            <p class="text-muted mb-4">Students will appear here once they are assigned to you by the administrator.</p>
            <a href="/supervisor/dashboard" class="btn btn-primary">
              <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
            </a>
          </div>
        <% } %>
      </div>
    </div>
  </div>