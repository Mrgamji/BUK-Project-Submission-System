<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Dashboard' %></title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom Styles -->
    <style>
        :root {
            --buk-blue: #0d6efd;
            --buk-dark: #212529;
        }
        
        .table th {
            font-weight: 600;
            color: var(--buk-dark);
        }

        .badge {
            font-weight: 500;
        }

        .progress {
            border-radius: 10px;
        }

        .card {
            transition: all 0.3s ease;
        }

        .student-checkbox:checked {
            background-color: var(--buk-blue);
            border-color: var(--buk-blue);
        }

        #selectedStudentsList .student-item {
            padding: 0.25rem 0.5rem;
            margin: 0.125rem 0;
            background: white;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        .page-title {
            color: var(--buk-dark);
            font-weight: 700;
        }
        
        .page-subtitle {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Navigation would be included here if needed -->
    
    <div class="container-fluid">
      <!-- Header Section -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h1 class="page-title mb-1">
                <i class="bi bi-speedometer2 me-2"></i>Level Coordinator Dashboard
              </h1>
              <p class="page-subtitle mb-0">Manage <%= typeof level !== 'undefined' ? level : '' %> Level students and supervisor assignments</p>
            </div>
            <div class="text-end">
              <div class="btn-group">
                <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#statsModal">
                  <i class="bi bi-graph-up me-1"></i>View Statistics
                </button>
                <button class="btn btn-outline-secondary" id="refreshBtn">
                  <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Alert Messages -->
      <% if (typeof success !== 'undefined' && success) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="bi bi-check-circle-fill me-2"></i><%= success %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>
      
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i><%= error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>

      <!-- Statistics Cards -->
      <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-2">Total Students</h6>
                  <h3 class="fw-bold text-primary mb-0"><%= totalStudents %></h3>
                </div>
                <div class="bg-primary bg-opacity-10 p-3 rounded">
                  <i class="bi bi-people-fill text-primary fs-4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-2">Assigned</h6>
                  <h3 class="fw-bold text-success mb-0"><%= assignedStudents %></h3>
                </div>
                <div class="bg-success bg-opacity-10 p-3 rounded">
                  <i class="bi bi-person-check text-success fs-4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-2">Unassigned</h6>
                  <h3 class="fw-bold text-warning mb-0"><%= unassignedStudents %></h3>
                </div>
                <div class="bg-warning bg-opacity-10 p-3 rounded">
                  <i class="bi bi-person-x text-warning fs-4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-2">Available Supervisors</h6>
                  <h3 class="fw-bold text-info mb-0"><%= totalSupervisors %></h3>
                </div>
                <div class="bg-info bg-opacity-10 p-3 rounded">
                  <i class="bi bi-person-badge text-info fs-4"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Student-Supervisor Assignments -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-semibold">
              <i class="bi bi-people me-2"></i>Student-Supervisor Assignments
            </h5>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#bulkAssignModal">
                <i class="bi bi-people-fill me-1"></i>Bulk Assign
              </button>
              <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#autoAssignModal">
                <i class="bi bi-magic me-1"></i>Auto Assign
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <% if (students && students.length > 0) { %>
            <div class="table-responsive">
              <table class="table table-hover align-middle" id="studentsTable">
                <thead class="table-light">
                  <tr>
                    <th>
                      <input type="checkbox" class="form-check-input" id="selectAll">
                    </th>
                    <th>Student Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th>Assigned Supervisor</th>
                    <th>Status</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% students.forEach((student, index) => { %>
                    <tr class="<%= !student.supervisor ? 'table-warning' : '' %>">
                      <td>
                        <input type="checkbox" class="form-check-input student-checkbox" value="<%= student.id %>">
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                            <i class="bi bi-person text-primary"></i>
                          </div>
                          <div>
                            <h6 class="mb-0 fw-semibold"><%= student.full_name %></h6>
                            <small class="text-muted">ID: <%= student.student_id || student.id %></small>
                          </div>
                        </div>
                      </td>
                      <td><%= student.email %></td>
                      <td><%= student.department || 'Not specified' %></td>
                      <td>
                        <% if (student.supervisor) { %>
                          <div class="d-flex align-items-center">
                            <div class="bg-success bg-opacity-10 rounded-circle p-1 me-2">
                              <i class="bi bi-person-check text-success"></i>
                            </div>
                            <span class="fw-semibold"><%= student.supervisor.full_name %></span>
                          </div>
                        <% } else { %>
                          <span class="badge bg-warning text-dark">
                            <i class="bi bi-person-x me-1"></i>Not Assigned
                          </span>
                        <% } %>
                      </td>
                      <td>
                        <% if (student.supervisor) { %>
                          <span class="badge bg-success">
                            <i class="bi bi-check-circle me-1"></i>Assigned
                          </span>
                        <% } else { %>
                          <span class="badge bg-warning text-dark">
                            <i class="bi bi-clock me-1"></i>Pending
                          </span>
                        <% } %>
                      </td>
                      <td class="text-end">
                        <div class="btn-group btn-group-sm">
                          <% if (student.supervisor) { %>
                            <form action="/coordinator/unassign-student/<%= student.assignmentId || student.id %>" method="POST" class="d-inline">
                              <button type="submit" class="btn btn-outline-danger" onclick="return confirm('Are you sure you want to unassign this student from <%= student.supervisor.full_name %>?')">
                                <i class="bi bi-x-circle"></i> Unassign
                              </button>
                            </form>
                          <% } %>
                          
                          <button 
                            class="btn <%= student.supervisor ? 'btn-outline-primary' : 'btn-primary' %> assign-btn"
                            data-bs-toggle="modal"
                            data-bs-target="#assignModal"
                            data-student-id="<%= student.id %>"
                            data-student-name="<%= student.full_name %>"
                            data-current-supervisor="<%= student.supervisor ? student.supervisor.id : '' %>">
                            <i class="bi bi-person-plus"></i>
                            <%= student.supervisor ? 'Reassign' : 'Assign' %>
                          </button>
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>

            <!-- Bulk Actions -->
            <div class="d-flex justify-content-between align-items-center mt-3 p-3 bg-light rounded">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="selectAllBottom">
                <label class="form-check-label text-muted" for="selectAllBottom">
                  Select all <%= students.length %> students
                </label>
              </div>
              <div class="btn-group">
                <button class="btn btn-outline-primary btn-sm" id="bulkAssignBtn" disabled>
                  <i class="bi bi-people-fill me-1"></i>Assign Selected
                </button>
                <button class="btn btn-outline-danger btn-sm" id="bulkUnassignBtn" disabled>
                  <i class="bi bi-x-circle me-1"></i>Unassign Selected
                </button>
              </div>
            </div>
          <% } else { %>
            <div class="text-center py-5">
              <i class="bi bi-people display-1 text-muted opacity-25 mb-3"></i>
              <h4 class="text-muted">No Students Found</h4>
              <p class="text-muted">There are no students assigned to <%= level %> Level.</p>
              <button class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i>Import Students
              </button>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Supervisor Availability -->
      <% if (supervisors && supervisors.length > 0) { %>
        <div class="card border-0 shadow-sm mt-4">
          <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0 fw-semibold">
              <i class="bi bi-person-badge me-2"></i>Supervisor Availability
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <% supervisors.forEach(supervisor => { 
                const assignedCount = students ? students.filter(s => s.supervisor && s.supervisor.id === supervisor.id).length : 0;
                const maxCapacity = supervisor.max_students || 5;
                const percentage = (assignedCount / maxCapacity) * 100;
                const statusClass = percentage >= 90 ? 'bg-danger' : percentage >= 70 ? 'bg-warning' : 'bg-success';
              %>
                <div class="col-md-6 col-lg-4 mb-3">
                  <div class="card border-0 h-100 <%= percentage >= 90 ? 'border-danger' : percentage >= 70 ? 'border-warning' : 'border-success' %>">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                          <h6 class="fw-semibold mb-1"><%= supervisor.full_name %></h6>
                          <small class="text-muted"><%= supervisor.email %></small>
                        </div>
                        <span class="badge <%= statusClass %>"><%= assignedCount %>/<%= maxCapacity %></span>
                      </div>
                      <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar <%= statusClass %>" 
                             role="progressbar" 
                             style="width: <%= percentage %>%"
                             aria-valuenow="<%= percentage %>" 
                             aria-valuemin="0" 
                             aria-valuemax="100"></div>
                      </div>
                      <small class="text-muted">
                        <% if (percentage >= 90) { %>
                          <i class="bi bi-exclamation-triangle text-danger me-1"></i>Full capacity
                        <% } else if (percentage >= 70) { %>
                          <i class="bi bi-info-circle text-warning me-1"></i>Limited availability
                        <% } else { %>
                          <i class="bi bi-check-circle text-success me-1"></i>Available
                        <% } %>
                      </small>
                    </div>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>
        </div>
      <% } %>
    </div>

    <!-- All your modals remain the same (Single Assign, Bulk Assign, Auto Assign, Statistics) -->
    <!-- Single Assign Modal -->
    <div class="modal fade" id="assignModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="/coordinator/assign-student" method="POST">
            <div class="modal-header">
              <h5 class="modal-title">Assign Supervisor</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" name="studentId" id="studentIdField">
              <div class="mb-3">
                <label class="form-label fw-semibold">Student</label>
                <input type="text" id="studentNameField" class="form-control" readonly>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Select Supervisor</label>
                <select class="form-select" name="supervisorId" id="supervisorSelect" required>
                  <option value="">Choose a supervisor...</option>
                  <% if (supervisors) { 
                    supervisors.forEach(supervisor => {
                      const assignedCount = students ? students.filter(s => s.supervisor && s.supervisor.id === supervisor.id).length : 0;
                      const maxCapacity = supervisor.max_students || 5;
                      const available = assignedCount < maxCapacity;
                  %>
                    <option value="<%= supervisor.id %>" <%= !available ? 'disabled' : '' %>>
                      <%= supervisor.full_name %> 
                      (<%= assignedCount %>/<%= maxCapacity %> students)
                      <%= !available ? ' - FULL' : '' %>
                    </option>
                  <% }); } %>
                </select>
                <div class="form-text">
                  <i class="bi bi-info-circle me-1"></i>
                  Supervisors with "FULL" have reached their maximum capacity
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-person-plus me-1"></i>Assign Supervisor
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bulk Assign Modal -->
    <div class="modal fade" id="bulkAssignModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="/coordinator/bulk-assign" method="POST" id="bulkAssignForm">
            <div class="modal-header">
              <h5 class="modal-title">Bulk Assign Supervisors</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label fw-semibold">Selected Students</label>
                <div id="selectedStudentsList" class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                  <small class="text-muted">No students selected</small>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Assign to Supervisor</label>
                <select class="form-select" name="supervisorId" required>
                  <option value="">Choose a supervisor...</option>
                  <% if (supervisors) { 
                    supervisors.forEach(supervisor => {
                      const assignedCount = students ? students.filter(s => s.supervisor && s.supervisor.id === supervisor.id).length : 0;
                      const maxCapacity = supervisor.max_students || 5;
                      const available = assignedCount < maxCapacity;
                  %>
                    <option value="<%= supervisor.id %>" <%= !available ? 'disabled' : '' %>>
                      <%= supervisor.full_name %> 
                      (<%= assignedCount %>/<%= maxCapacity %> students)
                      <%= !available ? ' - FULL' : '' %>
                    </option>
                  <% }); } %>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-people-fill me-1"></i>Assign All Selected
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Auto Assign Modal -->
    <div class="modal fade" id="autoAssignModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="/coordinator/auto-assign" method="POST">
            <div class="modal-header">
              <h5 class="modal-title">Auto-Assign Supervisors</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                This will automatically assign all unassigned students to available supervisors based on capacity.
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Unassigned Students</label>
                <div class="border rounded p-3 bg-light">
                  <h5 class="text-warning mb-2"><%= unassignedStudents %></h5>
                  <small class="text-muted">Students waiting for supervisor assignment</small>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Available Capacity</label>
                <div class="border rounded p-3 bg-light">
                  <h5 class="text-success mb-2"><%= availableCapacity %></h5>
                  <small class="text-muted">Total available supervisor slots</small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-magic me-1"></i>Run Auto-Assignment
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Statistics Modal -->
    <div class="modal fade" id="statsModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-graph-up me-2"></i>Assignment Statistics
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="fw-semibold text-muted mb-3">Assignment Overview</h6>
                <div class="list-group list-group-flush">
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Total Students</span>
                    <span class="fw-semibold"><%= totalStudents %></span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Assigned Students</span>
                    <span class="fw-semibold text-success"><%= assignedStudents %></span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Unassigned Students</span>
                    <span class="fw-semibold text-warning"><%= unassignedStudents %></span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Assignment Rate</span>
                    <span class="fw-semibold text-primary">
                      <%= totalStudents > 0 ? ((assignedStudents / totalStudents) * 100).toFixed(1) : 0 %>%
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h6 class="fw-semibold text-muted mb-3">Supervisor Load</h6>
                <div class="list-group list-group-flush">
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Total Supervisors</span>
                    <span class="fw-semibold"><%= totalSupervisors %></span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Available Capacity</span>
                    <span class="fw-semibold text-success"><%= availableCapacity %></span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                    <span>Average Load</span>
                    <span class="fw-semibold text-info">
                      <%= totalSupervisors > 0 ? (totalAssigned / totalSupervisors).toFixed(1) : 0 %> students/supervisor
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap & JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Single assign modal handling
      const assignModal = document.getElementById('assignModal');
      if (assignModal) {
        assignModal.addEventListener('show.bs.modal', function(event) {
          const button = event.relatedTarget;
          const studentId = button.getAttribute('data-student-id');
          const studentName = button.getAttribute('data-student-name');
          const currentSupervisor = button.getAttribute('data-current-supervisor');

          document.getElementById('studentIdField').value = studentId;
          document.getElementById('studentNameField').value = studentName;
          
          const modalTitle = assignModal.querySelector('.modal-title');
          modalTitle.textContent = `Assign Supervisor to ${studentName}`;
          
          // Preselect current supervisor if reassigning
          if (currentSupervisor) {
            document.getElementById('supervisorSelect').value = currentSupervisor;
          }
        });
      }

      // Select all functionality
      const selectAllCheckbox = document.getElementById('selectAll');
      const selectAllBottomCheckbox = document.getElementById('selectAllBottom');
      const studentCheckboxes = document.querySelectorAll('.student-checkbox');
      const bulkAssignBtn = document.getElementById('bulkAssignBtn');
      const bulkUnassignBtn = document.getElementById('bulkUnassignBtn');

      function updateBulkActions() {
        const checkedBoxes = document.querySelectorAll('.student-checkbox:checked');
        const hasSelection = checkedBoxes.length > 0;
        
        bulkAssignBtn.disabled = !hasSelection;
        bulkUnassignBtn.disabled = !hasSelection;
        
        // Update selected students list
        const selectedStudentsList = document.getElementById('selectedStudentsList');
        if (selectedStudentsList) {
          if (checkedBoxes.length > 0) {
            selectedStudentsList.innerHTML = '';
            checkedBoxes.forEach(checkbox => {
              const studentRow = checkbox.closest('tr');
              const studentName = studentRow.querySelector('h6').textContent;
              const studentItem = document.createElement('div');
              studentItem.className = 'student-item';
              studentItem.textContent = studentName;
              selectedStudentsList.appendChild(studentItem);
            });
          } else {
            selectedStudentsList.innerHTML = '<small class="text-muted">No students selected</small>';
          }
        }
      }

      function toggleSelectAll(checked) {
        studentCheckboxes.forEach(checkbox => {
          checkbox.checked = checked;
        });
        updateBulkActions();
      }

      if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
          toggleSelectAll(this.checked);
          if (selectAllBottomCheckbox) {
            selectAllBottomCheckbox.checked = this.checked;
          }
        });
      }

      if (selectAllBottomCheckbox) {
        selectAllBottomCheckbox.addEventListener('change', function() {
          toggleSelectAll(this.checked);
          if (selectAllCheckbox) {
            selectAllCheckbox.checked = this.checked;
          }
        });
      }

      studentCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateBulkActions);
      });

      // Bulk assign modal
      const bulkAssignModal = document.getElementById('bulkAssignModal');
      if (bulkAssignModal) {
        bulkAssignModal.addEventListener('show.bs.modal', function() {
          updateBulkActions();
        });
      }

      // Bulk assign form handling
      const bulkAssignForm = document.getElementById('bulkAssignForm');
      if (bulkAssignForm) {
        bulkAssignForm.addEventListener('submit', function(e) {
          const checkedBoxes = document.querySelectorAll('.student-checkbox:checked');
          const studentIds = Array.from(checkedBoxes).map(cb => cb.value);
          
          // Add hidden inputs for each selected student
          studentIds.forEach(studentId => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'studentIds';
            input.value = studentId;
            this.appendChild(input);
          });
        });
      }

      // Bulk unassign functionality
      if (bulkUnassignBtn) {
        bulkUnassignBtn.addEventListener('click', function() {
          const checkedBoxes = document.querySelectorAll('.student-checkbox:checked');
          const studentIds = Array.from(checkedBoxes).map(cb => cb.value);
          
          if (studentIds.length > 0 && confirm(`Are you sure you want to unassign ${studentIds.length} selected students?`)) {
            // Submit form for each student (simplified - you might want to create a bulk unassign endpoint)
            studentIds.forEach(studentId => {
              const form = document.createElement('form');
              form.method = 'POST';
              form.action = `/coordinator/unassign-student/${studentId}`;
              document.body.appendChild(form);
              form.submit();
            });
          }
        });
      }

      // Refresh button
      const refreshBtn = document.getElementById('refreshBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Refreshing...';
          this.disabled = true;
          setTimeout(() => {
            location.reload();
          }, 1000);
        });
      }

      // Initialize bulk actions
      updateBulkActions();
    });
    </script>
</body>
</html>